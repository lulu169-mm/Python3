### 1. 网络模型

#### (1). OSI七层模型

##### a. 介绍

* 国际标准化组织(ISO)于1984颁布了开放系统互连(OSI)参考模型

##### b. 分层

###### ①. 物理层

* 单位：比特
* 功能：传输**比特流**，与电信号相互转化

###### ②. 数据链路层

* 单位：帧
* 功能：建立逻辑连接。进行**硬件寻址**、差错校验等功能

###### ③. 网络层

* 单位：数据包
* 功能：进行**逻辑寻址**，实现不同网络的物理选择

###### ④. 传输层

* 单位：报文段/用户数据报

* 功能：定义传输数据的**协议**(TCP、UDP)和**端口号**，保证报文的正确传输

###### ⑤. 会话层

* 功能：**建立、管理和终止**表示层实体之间的通信**会话**

###### ⑥. 表示层

* 功能：处理数据的表示，如编码、**加解密**和格式转换等

###### ⑦. 应用层

* 功能：提供**接口**，实现各种**服务**

![OSI七层模型1-3](http://113.45.142.235:9001/laffrex/pictures/2024/10/13/202410131457104.png)

![OSI七层模型4-7](http://113.45.142.235:9001/laffrex/pictures/2024/10/13/202410131457636.png)

#### (2). TCP/IP协议模型

##### a. 介绍

* 是一个**协议族的统称**，包括了IP协议、ICMP协议、TCP协议、以及http、ftp、pop3、https协议等

##### b. 端口及协议号

###### ①. 端口号

* **HTTP：80**
* **HTTPS：443**
* POP3：110
* **FTP：20/21**
* SMTP：25
* Telnet：23
* **SSH：22**
* server：445
* **RDP：3389**
* **DNS：53**
* **DHCP：67/68**

###### ②. 协议号

* TCP：6
* UDP：17

##### c. 分层

###### ①. 网络接口层

1. 物理层：接收信号并将其转化为**比特流**，传递给数据链路层
2. 数据链路层：接收**数据帧**(**以太帧**)，去除数据链路层头部与尾部，将**数据包**传递给网络层

###### ②. 网络层

* 接收**数据包**，去除网络层头部，将**报文段**传递给传输层

###### ③. 传输层

* 接受**报文段**，去除传输层头部，将**数据**传递给应用层

###### ④. 应用层

* 接收**数据**并交给应用程序处理

### 2. 网络层

#### 	(1). ip地址

##### 	a. 概念

* 每一台计算机一个唯一的编号
* **唯一标识**，是一段**网络编码**，由32位组成

##### 	b. 格式

* 4个字节
* 常用点分十进制表示

##### 	c. 分类

###### ①A类

* 格式：第1个字节为网络地址，后3个字节为主机地址

* 范围：1.0.0.0 - 126.255.255.255

* 数量：256^3-2（一亿六千万多个）

###### ②B类

* 格式：前2个字节为网络地址，后2个字节为主机地址
* 范围：128.0.0.0 - 191.255.255.255
* 数量：256^2-2

###### ③C类

* 格式：前3个字节为网络地址，最后1个字节为主机地址
* 范围：192.0.0.0 - 223.255.255.255
* 数量：256-2

###### ④D类

* 格式：不划分网络地址与主机地址，第一个字节前4位固定位**1110**
* 范围：224.0.0.0 - 239.255.255.255
* 作用：作为**组播地址**，**无子网掩码**

###### ⑤E类

* 格式：不划分网络地址与主机地址，第一个字节前5位固定位**11110**
* 范围：240.0.0.0-255.255.255.255
* 作用：用于Internet科研(实验地址)

##### d. 特殊分类

1. 0.0.0.0：是所有**不清楚的主机和目的网络的**集合

2. 255.255.255.255：作为本网段内的**广播地址**

3. 127.0.0.1：**环回地址**，别名**Localhost**，**Windows下整个127.0.0.x均为环回地址**

4. 169.254.x.x：DHCP发生故障或响应时间太长时的地址

5. 私有地址
   1. 10.x.x.x

   2. 172.16.x.x ~ 172.31.x.x

   3. 192.168.x.x


##### e. 适用范围

<img src="http://113.45.142.235:9001/laffrex/pictures/2024/10/13/202410131452052.png" alt="IP地址分类适用范围" style="zoom:25%;" />

#### (2). 子网

##### 	a. 划分原因

* 有效利用地址空间
* 便于管理
* 可以隔离广播和通信，减少网络拥塞
* 出于安全方面的考虑

##### 	b. 划分方法

* 主机号拿出一部分来**标识子网**，另一部分任然做**主机号**
* 组成：**网络号 + 子网号 + 主机号** 

#### (3). 子网掩码

##### 	a. 介绍

* 不能单独存在，结合**IP地址**一起使用
* 将某个IP地址划分为**网络地址**和**主机地址两**部分

##### 	b. 确定规则

* 凡是IP地址的**网络和子网标识**部分，都用**二进制1**标识
* 凡是IP地址的**主机标识**部分，都用**二进制0**表示

##### 	c. 三种运算方式

###### 	①. 与运算( & )

###### 	②. 或运算( | )

###### 	③. 异或运算( ^ )

* 值不同为1，否则为0

```
 IP地址：11000000 10101000 00001010 11010111 => 192.168.10.215
子网掩码：11111111 11111111 11111111 00000000 => 255.255.255.0
与运算(&)
网络地址：11000000 10101000 00001010 00000000 => 192.168.10.0
```

#### 	(4). 无分类编址(CIDR)

##### 	a. 介绍

* 消除了传统的**A类、B类和C类地址**以及**划分子网**的概念
* 采用各种长度的“**网络前缀**”代替网络号和子网络号

##### 	b. 格式

* 采用**斜线记法**，分为**网络前缀**和**主机号**两部分
* 例如：127.14.35.7/20 

##### 	c. CIDR聚合

###### 	①. 聚合目的

* 将相邻的多个IP前缀合并为一个短前缀
* 聚合后的网段**刚好包含**合并前网段的所有地址

###### 	②. 聚合过程

```
1、2个前缀相同的网络可以聚合成一个网络
10111110 10111010 11011011 01011|000  => 190.186.219.88/29
10111110 10111010 11011011 01010|000  => 190.186.219.80/29
2、聚合之后
10111110 10111010 11011011 0101|0000  => 190.186.219.80/28
```

#### 	(5). 路由寻址

#####  a. 步骤

1. 主机A判断和主机B是否在同一个网络
2. 不在，则根据路由表规则，进行交接请求处理
3. 路由器判断主机B是否在主机A的F0/0网段，在则转发给对应主机(聚合因素)
4. 不在，查找其它接口，并继续判断
5. 都不存在，则废弃该消息

####  (6). GNS指令

```
1. 路由器配置
configure terminal   => conf t 	//c从用户模式进入全局模式
interface f 0/0  	=> int f 0/0	//进入端口进行配置
ip add 192.168.1.1 255.255.255.0	
no shutdown		//开启端口，默认是关闭
end		//保存退出（只本次生效）
wr	//将配置固定

2.PC配置
ip 192.168.71.45/24 192.168.71.1
save  //将配置保存至配置文件，下次启动自动加载
```

#### (7). 命令行配置模式

##### a用户模式

###### ①. 功能

* 用户模式是最基本的模式，用户可以查看设备的基本状态和一些非配置性的命令。无法进行配置更改。

###### ②常用命令

* `show`、`ping`、`traceroute` 等。

###### ③操作符

```
Switch>` 或 `Router>
```

##### b.特权模式

###### ①. 功能

* 特权模式允许执行更高级别的命令，包括查看详细信息和进入全局配置模式。需要通过输入 `enable` 命令从用户模式进入特权模式

###### ②常用命令

* 所有 `show` 命令、`copy`、`debug`、`reload` 等。

###### ③操作符

```
Switch#` 或 `Router#
```

##### c.全局配置模式

###### ①. 功能

* 在全局配置模式下，可以配置整个设备的系统参数和功能设置

###### ②常用命令

* `hostname`、`interface`、`router`、`line`、`ip` 等。

###### ③操作符

* ```
  Switch(config)#` 或 `Router(config)#
  ```



### 3. TCP/IP协议栈

####  (1). ARP协议

##### 	a. 介绍

* 将**IP地址**解析为**以太网MAC地址**的协议

##### 	b. 工作原理

1. 主机A在当前局域网**广播** **ARP请求数据报**，包含本机IP和MAC以及对方IP
2. 局域网每一台主机**接收并验证**，验证失败的主机则**废弃**该数据报
3. 验证成功的主机以**单播**返回**ARP响应报文**，包含接收方的**IP地址**和**MAC地址**

##### 	c. ARP缓存表

* 包含**IP地址**到**MAC地址**的映射关系

##### 	d. ARP报文格式

1. 操作类型：1代表请求报文，2代表响应报文
2. 源MAC地址
3. 源IP地址
4. 目的MAC地址
5. 目的IP地址

#### (2). IP协议

##### 	a. 格式

* 首部前一部分**固定20字节**，后一部分**可选字段长度可变**
* ![IP数据报格式](http://113.45.142.235:9001/laffrex/pictures/2024/10/13/202410131452056.png)

##### 	b. 重要字段分析

* 协议：占8位

  | 协议号 | 协议名 |
  | ------ | ------ |
  | 1      | ICMP   |
  | 6      | TCP    |
  | 17     | UDP    |

#### (3). ICMP协议

##### 	a. 介绍

* IPv4协议簇中的一个子协议，用于在**IP主机**与路由器之间传递控制信息
* 控制信息：**网络通不通**、**主机是否可达**、**路由是否可用**

##### 	b. 作用

* 在IP包无法传输时提供**差错报告**

##### 	c. 格式

* 包含在**IP数据报中**

##### 	d. 类型及含义

![ICMP协议类型含义](http://113.45.142.235:9001/laffrex/pictures/2024/10/13/202410131454135.png)

![ICMP协议类型](C:/Users/26254/AppData/Roaming/Typora/typora-user-images/image-20241013145500988.png)

##### 	(1). 重要字段结构

* 目的MAC地址

* 源MAC地址

* 上层协议

  | 字段   | 协议      |
  | ------ | --------- |
  | 0x0800 | IP协议帧  |
  | 0x0806 | ARP协议帧 |

### 4. 传输层协议

#### (1). TCP

##### 	a. 介绍

* 面向连接的、可靠的、基于字节流的传输层通信协议

##### 	b. 主要特点

* **面向连接**的传输协议
* 仅支持**单播传输**
* 提供**可靠交付**
* 基于**字节流**

##### 	c. 数据段格式

###### 	 ①. 源端口和目的端口

* 各占16位

###### 	 ②. 序号

* 占32位

###### 	 ③. 确认号

* 占32位

###### 	④. 数据偏移

###### 	 ⑤. 确认位ACK

###### 	 ⑥ 复位RST

###### 	 ⑦. 同步位SYN

###### 	 ⑧. 终止位FIN

##### 	d. 端口

###### 	 ①. 系统端口号

范围：0~1023

* FTP：21
* TELNET：23
* SMTP：25
* DNS：53
* HTTP：80
* HTTPS：443

###### 	 ②. 登记端口号

###### 	 ③. 动态端口号

##### 	e. 连接建立

###### 	 ①. 三次握手

###### 	 ②. 四次挥手

##### 	f. 可靠传输原理

###### 	 ①. 无差错情况

###### 	 ②. 超时重传

* 发送方保存发送分组的副本
* 分组和确认分组必须编号
* 超时计时器重传时间大于平均往返时间

###### 	 ③. 确认包丢失

* 丢弃重复数据包
* 接收方重新发送确认

###### 	 ④. 确认包迟到

#### (2). UDP

#####   a. 介绍

* 无链接传输层协议

#####   b. 主要特点

* 发送数据之前**不需要建立连接**
* **不保证**可靠交付
* **面向报文的**
* 支持一对一、一对多、多对一和多对多

#####   c. 数据报格式

###### 	 ①. 源端口

###### 	  ②. 目的端口

###### 	  ③. 长度

###### 	  ④. 校验和

#### (3).  TCP与UDP异同点

##### 	a. 相同点

* 都是传输层协议
* 都需要开放端口

##### 	b. 差异点

![差异点](http://113.45.142.235:9001/laffrex/pictures/2024/10/13/202410131501764.png)

### 5. 应用层协议

####  (1). DNS协议

#####   a. 介绍

* 将**域名**解析到**IP地址**的一种协议
* DNS协议基于**TCP/UDP**协议的，端口**53**
* 采用**客户机/服务端**模式运行在通信的端系统之间
* 可以输入**nslookup**命令查询域名对应**IP地址**

#####   b. 域名组成 

![域名组成](http://113.45.142.235:9001/laffrex/pictures/2024/10/13/202410131501770.png)

#####   c. DNS解析

###### 	  ①. 查询方式

1. 递归查询
   * 客户机向本地DNS服务器查询，由本地DNS服务器进行跳转(**客户机只发起一次请求**)
2. 迭代查询
   * 客户机向本地DNS服务器查询，返回结果未命中，客户机继续向下一级DNS服务器发起请求(**客户机发起多次请求**)

###### 	  ②. 查询内容

1. 正向解析
   * 已知域名，解析IP地址
2. 反向解析
   * 已知IP地址，解析域名

###### ③. 字段含义

![DNS字段](http://113.45.142.235:9001/laffrex/pictures/2024/10/13/202410131501774.png)

####  (2). DHCP协议

##### 	a. 介绍

* 简化主机IP配置管理的TCP/IP标准协议
* 协议端口：**UDP 67 / 68**
* **自动分配**IP地址，并提供安全可靠、简单的TCP/IP网络配置

##### 	b. 原理

1. 客户机**广播请求IP地址**
2. 服务器**响应**提供的IP地址
3. 客户机**选择IP**
4. 服务器**确定了租约**，并提供网卡详细参数

##### 	c. 字段含义

![DHCP字段](http://113.45.142.235:9001/laffrex/pictures/2024/10/13/202410131501786.png)

## 