### 1. SQL注入

#### (1).概念

```
攻击者将精心构造的payload，传递给数据库，数据库没有进行过滤或者严格过滤，导致数据库被泄露、篡改或破坏
```

#### (2).关键条件

```
1. 用户能控制输入内容
2. 执行内容没经过过滤或严格过滤
```

#### (3).万能密码

```
通过构造特殊的SQL语句，攻击者能够在输入任何密码的情况下登录目标系统，甚至以管理员身份登录
```

#### (4).分类

```
union查询
报错注入
布尔盲注
时间盲注
数据外带
其他注入()
```

#### (5).基本步骤

```
1. 判断漏洞
2. 获取数据库数据(数据库名、表名、字段名、字段数据)
3. 破解加密
4. 提升权限
5. 内网渗透
```

### 2. 联合查询

#### (1).概念

```
使用拼接联合方式将2组或多组关键值拼凑起来进行查询
```

#### (2).使用条件

```
拼接语句，查询列数和数据必须一致
页面需要有显示位
```

#### (3).操作步骤

```
1. 判断注入点
2. 判断列数
3. 判断显示位
4. 获取数据库数据()
5. 破解加密
```

#### (4).系统内置数据库

```
information_schema内置数据库，有3张表
	1. information_schema.schemata表，有1个常用字段：
		①schema_name
	2. information_schema.tables表，有2个常用字段：
		①table_schema
		②table_name
	3. information_schema.columns表，有3个常用字段：
		①table_schema
		②table_name
		③column_name
```

#### (5).字符串连接函数

```
1. concat()
	连接字符串
2. concat_ws()
	连接字符串，可以在第一位指定分隔符
3. group_concat()
	多行数据并为一行输出，可以使用 'separator+符号' 指定分隔符
```

### 3. 报错注入

#### (1).概念

```
利用数据库的 ‘某些机制’ ，‘人为’制造错误并在 ‘错误信息中’ 显示查询结果
```

#### (2).分类

```
1. XPATH
	①extractvalue()
	②updatexml()
2. 主键冲突
	floor()
3. 其他报错注入
	a. 列明重复
		name_const()
	b. 整数溢出
		exp()
	c. 几何函数
		①geometrycollection()
		②multipoint()
		③polygon()、multipolygon()
		④linestring()、multilinestring()
4. json报错
	①json_type()
	②json_extract()
	③json_array_append()
```

#### (3).操作步骤

```
1. 查看系统变量信息(数据库version()、user()等)
2. 查看数据库名字
3. 查看表个数、表名
4. 查看字段个数、字段名
5. 查看字段内数据
```

### 4. 布尔盲注

#### (1).概念

```
页面只返回True或False的信息，根据返回的‘正确与否’猜解‘信息’
```

#### (2).相关函数

```
1. 长度截取
	substr()、substring()、mid()
2. 长度判断
	length()
3. 字符转换
	ascii()
4. 条件判断
	if(exp1,true,false)
```

#### (3).使用步骤

```
1. 获取数据库名长度、暴力破解数据库名
2. 获取表名长度、暴力破解表名
3. 获取字段名长度、暴力破解字段名
4. 获取字段内数据长度、暴力破解字段内数据内容
```

### 5. 时间盲注

#### (1).概念

```
通过‘返回结果的时间长短’来判断是否注入成功
```

#### (2).相关函数

```
1. sleep()
2. benchmark()
```

#### (3).使用步骤

```
1. 获取数据库名长度、暴力破解数据库名
2. 获取表名长度、暴力破解表名
3. 获取字段名长度、暴力破解字段名
4. 获取字段内数据长度、暴力破解数据内容
```

### 6.数据外带

#### (1).DNSLOG平台

```
dnslog.cn
eyes.sh
BurpSuite Collaborator

```

#### (2).secure_file_priv

* 控制**load_file()**函数是否起作用

```
值为""：可以读取任意目录
值为null：不能加载文件
值为"/var/www/html"：只能加载该目录下文件
```

#### (3). DNS数据外带与SMP数据外带区别

```
DNS数据外带有253字符长度限制，子域名有63长度限制；不支持敏感符号；支持DNS出网
SMB数据外带没有长度和符号限制；需默认支持TCP/UDP出网方式
```

### 7.其他类型注入

#### (1). 宽字节

##### a. 定义及成因

```
宽字节注入是指使用gbk编码时，mysql会把2个字符认为是1个汉字，其中第一个字符[129,254],第二个字符[64,254]
```

##### b. 过滤及字符集方法

```
1.过滤
	preg_replace()
	addslashes()
	real_escape_string()
	mysql_real_escape_string()
2.字符集
	mysql_query()
	mysql_set_charset()
```

##### c. 宽字节注入修复

```
1. 使用mysql_query的connection、result、client的方式
2. 使用过滤函数
```

#### (2). HTTP头

##### a. 定义

```
用户提交的HTTP请求包头信息未被过滤，直接带入到数据库执行，导致的sql注入问题，被称为HTTP头注入
```

##### b. 产生原因

```
1. 网页代码中的 ‘ip字段’ 与数据库 ‘有交互’
2. 代码中使用了 ‘超全局变量$_SERVER[]’
```

##### c. 修复

```
1. 过滤回车换行符
2. 对参数做合法性校验、长度限制
3. 不使用有漏洞版本的apache服务器
```

#### (3). 二次编码

##### a. 原理

```
使用过滤函数addslashes()时，特殊符号前加的反斜杠转义字符会被urldeecode()等函数再一次解码，去掉转义字符，从而导致转义失败
```

#### (4). Base64

##### a. 步骤

```
1.获取原参数
2.解密后进行语句设计
3.base64编码后进行注入
```

#### (5). 堆叠

##### a. 定义

```
使用分号隔开多个sql语句，使得多个sql语句可以叠加在一起执行
```

##### b. 与联合注入区别

```
堆叠查询可以执行任意语句，功能强大
联合查询执行的语句类型有限，通常执行查询语句
```

##### c. 限制条件

```
1. 需知道数据库的表名、列名等
2. 不支持mysql_query,支持mysqli_multi_query()
3. 可能受到API或数据引擎不支持的限制
```

#### (6). 二次

##### a. 定义

```
已存储的用户输入(恶意代码)被读取后，再次进入到sql查询语句中导致的注入
```

##### b. 原理

```
1. 网站在对用户‘输入恶意数据’时进行‘转义’处理
2. 恶意数据‘插入’到数据库时又‘被还原并存储’到数据库中
3. 系统‘再次调用’该恶意数据并‘执行’sql查询时，因为没有做‘转义’处理，被成功注入
```

