{"ID":"20240914130034-suvc1uz","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240914130034-suvc1uz","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20240914130034-suvc1uz\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20240914130034-bm5xywr\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20240914144440-4r19a59\u0026quot;,\u0026quot;scrollTop\u0026quot;:138,\u0026quot;focusId\u0026quot;:\u0026quot;20240914130034-bm5xywr\u0026quot;,\u0026quot;focusStart\u0026quot;:0,\u0026quot;focusEnd\u0026quot;:0\u0026#125;","title":"PHP反序列化漏洞","updated":"20241021134048"},"Children":[{"ID":"20241021132611-4ob5y60","Type":"NodeBlockquote","Properties":{"id":"20241021132611-4ob5y60","updated":"20241021132639"},"Children":[{"ID":"20240914130034-bm5xywr","Type":"NodeParagraph","Properties":{"id":"20240914130034-bm5xywr","updated":"20241021132612"},"Children":[{"Type":"NodeText","Data":"序列化概念：将对象的状态信息转换为可以存储或传输的形式（字符串）的过程"}]},{"ID":"20240914133134-z03at31","Type":"NodeParagraph","Properties":{"id":"20240914133134-z03at31","updated":"20240914133325"},"Children":[{"Type":"NodeText","Data":"本质就是将对象变为可以传输的字符串，再特定的格式和进程中去跨平台传输或通信"}]},{"ID":"20241021132639-lp9p6uj","Type":"NodeParagraph","Properties":{"id":"20241021132639-lp9p6uj","updated":"20241021132639"},"Children":[{"Type":"NodeText","Data":"序列化    对象----字符串"}]},{"ID":"20241021132639-o0fuz1x","Type":"NodeParagraph","Properties":{"id":"20241021132639-o0fuz1x","updated":"20241021132639"},"Children":[{"Type":"NodeText","Data":"serialize()"}]},{"ID":"20241021132639-jczrlee","Type":"NodeParagraph","Properties":{"id":"20241021132639-jczrlee","updated":"20241021132639"},"Children":[{"Type":"NodeText","Data":"反序列化 字符串--对象（字符串还原）"}]},{"ID":"20241021132639-qty663v","Type":"NodeParagraph","Properties":{"id":"20241021132639-qty663v","updated":"20241021132639"},"Children":[{"Type":"NodeText","Data":"unserialize()"}]},{"Type":"NodeBlockquoteMarker","Data":"\u003e"}]},{"ID":"20240914133401-7in1js6","Type":"NodeParagraph","Properties":{"id":"20240914133401-7in1js6"}},{"ID":"20240914133527-7nom4zo","Type":"NodeParagraph","Properties":{"id":"20240914133527-7nom4zo","updated":"20241021133747"}},{"ID":"20240914133632-k5507k9","Type":"NodeParagraph","Properties":{"id":"20240914133632-k5507k9","updated":"20240914134219"},"Children":[{"Type":"NodeText","Data":"序列化过程"}]},{"ID":"20240914134506-ye6sze8","Type":"NodeParagraph","Properties":{"id":"20240914134506-ye6sze8","updated":"20240914134506"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240914134506-vx0fth3.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240914134403-7vybf7x","Type":"NodeParagraph","Properties":{"id":"20240914134403-7vybf7x","updated":"20240914134403"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240914134403-26ru1a7.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240914134403-ceygj8d","Type":"NodeParagraph","Properties":{"id":"20240914134403-ceygj8d","updated":"20240914134407"},"Children":[{"Type":"NodeText","Data":"反序列化过程"}]},{"ID":"20240914134625-25bjs3i","Type":"NodeParagraph","Properties":{"id":"20240914134625-25bjs3i","updated":"20240914134625"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240914134625-olkewit.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240914134627-7tiv8zq","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240914134627-7tiv8zq","updated":"20240914134646"},"Children":[{"Type":"NodeText","Data":"反序列化漏洞"}]},{"ID":"20241021132647-r2xlid3","Type":"NodeHeading","HeadingLevel":5,"Properties":{"fold":"1","id":"20241021132647-r2xlid3","updated":"20241021132654"},"Children":[{"Type":"NodeText","Data":"产生"}]},{"ID":"20241021132657-i2mc0b7","Type":"NodeParagraph","Properties":{"fold":"1","heading-fold":"1","id":"20241021132657-i2mc0b7","updated":"20241021133011"},"Children":[{"Type":"NodeText","Data":"当应用程序反序列化来自"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"不可信源数据"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"时，如果"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"没有适当的验证和安全措施"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"，攻击者可以操纵这些数据来执行恶意代码"}]},{"ID":"20241021133750-iyc5l80","Type":"NodeParagraph","Properties":{"fold":"1","heading-fold":"1","id":"20241021133750-iyc5l80","updated":"20241021133750"},"Children":[{"Type":"NodeText","Data":"反序列化漏洞（对象注入）：用户可以控制序列化过程中的参数，传入序列化的字符串，再使用unserialize函数的时候"}]},{"ID":"20241021132648-jxotkch","Type":"NodeHeading","HeadingLevel":5,"Properties":{"fold":"1","id":"20241021132648-jxotkch","updated":"20241021132801"},"Children":[{"Type":"NodeText","Data":"条件"}]},{"ID":"20241021132804-onn9l5v","Type":"NodeParagraph","Properties":{"fold":"1","heading-fold":"1","id":"20241021132804-onn9l5v","updated":"20241021133016"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"信任外部输入"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"：应用程序"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"盲目"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"信任外部输入的数据进行反序列化"}]},{"ID":"20241021132842-2wne4wv","Type":"NodeParagraph","Properties":{"fold":"1","heading-fold":"1","id":"20241021132842-2wne4wv","updated":"20241021133024"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"缺乏输入验证"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"：缺乏对反序列化数据"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"严格验证"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"和清洁化"}]},{"ID":"20241021132907-sgpaonp","Type":"NodeParagraph","Properties":{"fold":"1","heading-fold":"1","id":"20241021132907-sgpaonp","updated":"20241021133029"},"Children":[{"Type":"NodeText","Data":"使用"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"不安全的库或方法"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"：使用存在已知漏洞的序列化、反序列化库"}]},{"ID":"20241021132955-k4d3xlz","Type":"NodeParagraph","Properties":{"fold":"1","heading-fold":"1","id":"20241021132955-k4d3xlz"}},{"ID":"20241021133043-wps8wuq","Type":"NodeHeading","HeadingLevel":5,"Properties":{"fold":"1","id":"20241021133043-wps8wuq","updated":"20241021133047"},"Children":[{"Type":"NodeText","Data":"攻击方法"}]},{"ID":"20241021133047-7vv28qw","Type":"NodeParagraph","Properties":{"fold":"1","heading-fold":"1","id":"20241021133047-7vv28qw","updated":"20241021133149"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"构造恶意输入"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"：利用程序的反序列化功能，发送经过精心构造的恶意数据"}]},{"ID":"20241021133118-zfbnfra","Type":"NodeParagraph","Properties":{"fold":"1","heading-fold":"1","id":"20241021133118-zfbnfra","updated":"20241021133152"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"利用已知漏洞"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"：针对特定框架或库的已知反序列化漏洞进行攻击"}]},{"ID":"20241021133041-v31r2zm","Type":"NodeParagraph","Properties":{"fold":"1","heading-fold":"1","id":"20241021133041-v31r2zm"}},{"ID":"20241021133041-s8ayh35","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20241021133041-s8ayh35","updated":"20241021133200"},"Children":[{"Type":"NodeText","Data":"危害"}]},{"ID":"20241021133203-2usagk7","Type":"NodeParagraph","Properties":{"id":"20241021133203-2usagk7","updated":"20241021133234"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"远程代码执行"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"：攻击者可能执行任意代码，控制受影响的系统。"}]},{"ID":"20241021133214-lhfpghf","Type":"NodeParagraph","Properties":{"id":"20241021133214-lhfpghf","updated":"20241021133244"},"Children":[{"Type":"NodeText","Data":"数据泄露：攻击者可能执行任意代码，控制受影响的系统。"}]},{"ID":"20241021133219-volgijo","Type":"NodeParagraph","Properties":{"id":"20241021133219-volgijo","updated":"20241021133248"},"Children":[{"Type":"NodeText","Data":"拒绝服务攻击:通过构造特殊的对象导致应用崩溃，造成服务不可用。"}]},{"ID":"20241021133041-6bbs685","Type":"NodeParagraph","Properties":{"id":"20241021133041-6bbs685"}},{"ID":"20241021133041-owkltj3","Type":"NodeParagraph","Properties":{"id":"20241021133041-owkltj3","updated":"20241021134048"},"Children":[{"Type":"NodeText","Data":"序列化是没有漏洞的，但是搭配"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color9);"},"TextMarkType":"text","TextMarkTextContent":"魔法函数"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color9);\"}"},{"Type":"NodeText","Data":"，才能产生反序列化漏洞"}]},{"ID":"20240914134737-7by60i5","Type":"NodeParagraph","Properties":{"id":"20240914134737-7by60i5","updated":"20240914134833"},"Children":[{"Type":"NodeText","Data":"_construct()函数：当一个对象被创建时，会被调用执行"}]},{"ID":"20240914134917-r2a6nhx","Type":"NodeParagraph","Properties":{"id":"20240914134917-r2a6nhx","updated":"20240914134917"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240914134917-igwkehx.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240914135043-u5137qb","Type":"NodeParagraph","Properties":{"id":"20240914135043-u5137qb"}},{"ID":"20240914135044-sk8108b","Type":"NodeParagraph","Properties":{"id":"20240914135044-sk8108b","updated":"20240914135112"},"Children":[{"Type":"NodeText","Data":"_destruct()当一个对象被销毁时，触发"}]},{"ID":"20240914135131-j2wp1uc","Type":"NodeParagraph","Properties":{"id":"20240914135131-j2wp1uc","updated":"20240914135131"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240914135131-fdzq2vw.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240914135340-9494sv2","Type":"NodeParagraph","Properties":{"id":"20240914135340-9494sv2"}},{"ID":"20240914135329-mhnq56u","Type":"NodeParagraph","Properties":{"id":"20240914135329-mhnq56u","updated":"20240914135650"},"Children":[{"Type":"NodeText","Data":"__sleep()当对象被序列化时被调用"}]},{"ID":"20240914135731-61mjri3","Type":"NodeParagraph","Properties":{"id":"20240914135731-61mjri3","updated":"20240914135830"},"Children":[{"Type":"NodeText","Data":"__toString()当对象被当做字符串时触发"}]},{"ID":"20240914140150-czi23bt","Type":"NodeParagraph","Properties":{"id":"20240914140150-czi23bt","updated":"20240914140856"},"Children":[{"Type":"NodeText","Data":"__wakeup()反序列化时触发，unserialize()户检查是否存在=】 wakeup()魔法函数，如果存在则先调用魔法函数wakeup的方法，预先准备对象的"}]},{"ID":"20240914140416-ntiaccq","Type":"NodeParagraph","Properties":{"id":"20240914140416-ntiaccq","updated":"20240914140416"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240914140416-5u704tl.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240914141013-9rqrpqy","Type":"NodeParagraph","Properties":{"id":"20240914141013-9rqrpqy"}},{"ID":"20240914141015-e4q042x","Type":"NodeParagraph","Properties":{"id":"20240914141015-e4q042x"}},{"ID":"20240914141228-rnt97a9","Type":"NodeParagraph","Properties":{"id":"20240914141228-rnt97a9","updated":"20240914141710"},"Children":[{"Type":"NodeText","Data":"漏洞代码"}]},{"ID":"20240914141710-vs3n6w5","Type":"NodeParagraph","Properties":{"id":"20240914141710-vs3n6w5","updated":"20240914143605"},"Children":[{"Type":"NodeText","Data":"①payload：?code=O:4:\"Test\":1:{s:3:\"str\";s:6:\"whoami\"}"}]},{"ID":"20240914141634-k80f5r2","Type":"NodeParagraph","Properties":{"id":"20240914141634-k80f5r2","updated":"20240914141634"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240914141634-n0kq0p2.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240914143606-qvp7bt6","Type":"NodeParagraph","Properties":{"id":"20240914143606-qvp7bt6"}},{"ID":"20240914143607-f22ng05","Type":"NodeParagraph","Properties":{"id":"20240914143607-f22ng05","updated":"20240914143725"},"Children":[{"Type":"NodeText","Data":"②​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240914143725-vcu2i42.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240914143755-7l4qrau","Type":"NodeParagraph","Properties":{"id":"20240914143755-7l4qrau"}},{"ID":"20240914143757-lilmtds","Type":"NodeParagraph","Properties":{"id":"20240914143757-lilmtds","updated":"20240914143759"},"Children":[{"Type":"NodeText","Data":"防御"}]},{"ID":"20240914143803-9x7t22x","Type":"NodeParagraph","Properties":{"id":"20240914143803-9x7t22x","updated":"20240914143908"},"Children":[{"Type":"NodeText","Data":"1.序列化函数内使用的参数用户不可控"}]},{"ID":"20240914143909-yoeqf1d","Type":"NodeParagraph","Properties":{"id":"20240914143909-yoeqf1d","updated":"20240914143931"},"Children":[{"Type":"NodeText","Data":"2.过滤用户输入 O： s i b"}]},{"ID":"20240914143939-el0zy2t","Type":"NodeParagraph","Properties":{"id":"20240914143939-el0zy2t","updated":"20240914144425"},"Children":[{"Type":"NodeText","Data":"3.序列化后的内容进行检查，确保安全后再展示输出"}]},{"ID":"20240914144426-omr6jjz","Type":"NodeParagraph","Properties":{"id":"20240914144426-omr6jjz"}},{"ID":"20240914144440-twxf1xm","Type":"NodeParagraph","Properties":{"id":"20240914144440-twxf1xm"}},{"ID":"20240914144440-4r19a59","Type":"NodeParagraph","Properties":{"id":"20240914144440-4r19a59"}}]}