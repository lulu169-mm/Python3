{"ID":"20241014163045-z3ejf42","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f945","id":"20241014163045-z3ejf42","title":"MongoDB服务安全加固","updated":"20241014183019"},"Children":[{"ID":"20241014163112-y0ivpdp","Type":"NodeParagraph","Properties":{"id":"20241014163112-y0ivpdp","updated":"20241014163112"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241014163112-31s7uc0.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241014163113-5jp6m9b","Type":"NodeParagraph","Properties":{"id":"20241014163113-5jp6m9b","updated":"20241014163221"},"Children":[{"Type":"NodeText","Data":"配置文件路径：/etc/mongodb.conf"}]},{"ID":"20241014163114-yde55et","Type":"NodeParagraph","Properties":{"id":"20241014163114-yde55et"}},{"ID":"20241014163114-u3x6pch","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241014163114-u3x6pch","updated":"20241014163200"},"Children":[{"Type":"NodeText","Data":"1.修改监听地址"}]},{"ID":"20241014163344-fwlbxi7","Type":"NodeParagraph","Properties":{"id":"20241014163344-fwlbxi7","updated":"20241014163441"},"Children":[{"Type":"NodeText","Data":"默认端口：27017 改为不常见端口 如：27020"}]},{"ID":"20241014163443-vmiplh0","Type":"NodeParagraph","Properties":{"id":"20241014163443-vmiplh0","updated":"20241014163507"},"Children":[{"Type":"NodeText","Data":"bindip 默认0.0.0.0（所有都可以访问），建议改为127.0.0.1"}]},{"ID":"20241014163342-4kxnbh1","Type":"NodeParagraph","Properties":{"id":"20241014163342-4kxnbh1","updated":"20241014163342"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241014163342-v15rx8x.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241014163201-3j0anzu","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241014163201-3j0anzu","updated":"20241014163523"},"Children":[{"Type":"NodeText","Data":"2.设置账户和密码，并开启授权!…-对未授权访问进行修复"}]},{"ID":"20241014164247-4arnxh9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241014164247-4arnxh9","updated":"20241014183019"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"#[root@localhost phpmyadmin]#mongo  #登录默认端口27017    mongo IP:PORT\n[root@localhost phpmyadmin]#mongod -f /etc/mongod.conf --auth   #认证模式启动进行以\n下操作。\nMongoDB shell version v4.4.6\nconnecting to: mongodb://127.0.0.1:27017/?\ncompressors=disabled\u0026gssapiServiceName=mongodb\nImplicit session: session { \"id\" : UUID(\"8cb1eb24-1955-43ab-821d-d67b3a44246c\") \n}\nMongoDB server version: 4.2.14\nWARNING: shell and server versions do not match\n---\nThe server generated these startup warnings when booting: \n2024-10-14T06:23:32.803+0800 I  CONTROL  [initandlisten] \n2024-10-14T06:23:32.803+0800 I  CONTROL  [initandlisten] ** WARNING: Access \ncontrol is not enabled for the database.\n2024-10-14T06:23:32.803+0800 I  CONTROL  [initandlisten] **          Read and \nwrite access to data and configuration is unrestricted.\n2024-10-14T06:23:32.803+0800 I  CONTROL  [initandlisten] \n2024-10-14T06:23:32.810+0800 I  CONTROL  [initandlisten] \n2024-10-14T06:23:32.810+0800 I  CONTROL  [initandlisten] ** WARNING: \n/sys/kernel/mm/transparent_hugepage/enabled is 'always'.\n2024-10-14T06:23:32.810+0800 I  CONTROL  [initandlisten] **        We suggest \nsetting it to 'never'\n2024-10-14T06:23:32.811+0800 I  CONTROL  [initandlisten] \n设置认证登录  \n2024-10-14T06:23:32.811+0800 I  CONTROL  [initandlisten] ** WARNING: \n/sys/kernel/mm/transparent_hugepage/defrag is 'always'.\n2024-10-14T06:23:32.811+0800 I  CONTROL  [initandlisten] **        We suggest \nsetting it to 'never'\n2024-10-14T06:23:32.811+0800 I  CONTROL  [initandlisten] \n---\n---\n        Enable MongoDB's free cloud-based monitoring service, which will then \nreceive and display\n        metrics about your deployment (disk utilization, CPU, operation \nstatistics, etc).\n        The monitoring data will be available on a MongoDB website with a unique \nURL accessible to you\n        and anyone you share the URL with. MongoDB may use this information to \nmake product\n        improvements and to suggest MongoDB products and deployment options to \nyou.\n        To enable free monitoring, run the following command: \ndb.enableFreeMonitoring()\n        To permanently disable this reminder, run the following command: \ndb.disableFreeMonitoring()\n---\n\u003e use admin     #选中admin数据库（默认存在）\nswitched to db admin\n\u003e db.createUser({user:\"admin\",pwd:\"ETsafe666\",roles:[\"root\"]})  #为admin数据库创建\n一个角色权限为root的账户admin并设置密码ETsafe666\nSuccessfully added user: { \"user\" : \"admin\", \"roles\" : [ \"root\" ] }\n\u003e db.getUsers()\n[\n    {\n        \"_id\" : \"admin.admin\",\n        \"userId\" : UUID(\"afa27eed-8b1b-48e0-989c-395f3ca40ce4\"),\n        \"user\" : \"admin\",\n        \"db\" : \"admin\",\n        \"roles\" : [\n            {\n                \"role\" : \"root\",\n                \"db\" : \"admin\"\n            }\n        ],\n        \"mechanisms\" : [\n            \"SCRAM-SHA-1\",\n            \"SCRAM-SHA-256\"\n        ]\n    }\n]\n\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241014164251-jq3h8nn","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20241014164251-jq3h8nn","updated":"20241014164850"},"Children":[{"Type":"NodeText","Data":"设置认证登录"}]},{"ID":"20241014164301-2rm7oye","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241014164301-2rm7oye","updated":"20241014182945"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"]\n\u003e db.auth('admin','ETsafe666')  #设置认证登录\n1       #成功返回1\n\u003e db.getUsers()\n[\n3、禁用http和 rest端口\n4、日志审计\n配置审计功能记录用户对数据库的相关操作\n默认开启：\n \n    {\n        \"_id\" : \"admin.admin\",\n        \"userId\" : UUID(\"afa27eed-8b1b-48e0-989c-395f3ca40ce4\"),\n        \"user\" : \"admin\",\n        \"db\" : \"admin\",\n        \"roles\" : [\n            {\n                \"role\" : \"root\",\n                \"db\" : \"admin\"\n            }\n        ],\n        \"mechanisms\" : [\n            \"SCRAM-SHA-1\",\n            \"SCRAM-SHA-256\"\n        ]\n    }\n]\n\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241014164854-xyl1e97","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241014164854-xyl1e97","updated":"20241014164907"},"Children":[{"Type":"NodeText","Data":"3.禁用http和rest端口"}]},{"ID":"20241014164909-qhhkox6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241014164909-qhhkox6","updated":"20241014182922"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"nohttpinterface = false  #重启服务后，会关闭下图所示的web服务，多余的\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241014164917-dff8mqo","Type":"NodeParagraph","Properties":{"id":"20241014164917-dff8mqo","updated":"20241014164917"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241014164917-4z0b9bk.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241014164917-fiokqi3","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241014164917-fiokqi3","updated":"20241014164922"},"Children":[{"Type":"NodeText","Data":"4.日志审计"}]},{"ID":"20241014164933-5s3l30b","Type":"NodeParagraph","Properties":{"id":"20241014164933-5s3l30b","updated":"20241014165035"},"Children":[{"Type":"NodeText","Data":"配置审计功能记录用户对数据库的相关操作"}]},{"ID":"20241014165035-6w4r7kk","Type":"NodeParagraph","Properties":{"id":"20241014165035-6w4r7kk","updated":"20241014165039"},"Children":[{"Type":"NodeText","Data":"默认开启："}]},{"ID":"20241014165042-40dturm","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241014165042-40dturm","updated":"20241014182900"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"systemLog:\n  destination: file\n  logAppend: true\n  path: /var/log/mongodb/mongod.log\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241014165053-j2pmz67","Type":"NodeParagraph","Properties":{"id":"20241014165053-j2pmz67","updated":"20241014165053"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241014165053-cfrzrxs.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241014165054-6umr0lr","Type":"NodeParagraph","Properties":{"id":"20241014165054-6umr0lr"}}]}